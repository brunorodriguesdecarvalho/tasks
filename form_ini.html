<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Nova Iniciativa</title>
        <link rel="stylesheet" type="text/css" href="style.css">
        <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
        <script src="./src/form_ini.js" type="text/javascript"></script>
    </head>
    <body>
        <div id="app">
            <a href="index.html">HOME</a> ou <a href="list_ini.html">INICIATIVAS</a>
            <h1>Nova Iniciativa</h1>
            <div class="grupo">
                <form>
                    <div class="linha">
                        <div class="celula">Título:</div>
                        <div class="celula entrada">
                            <input 
                                type="text" 
                                id="iniNome" 
                                placeholder="Preencher com um nome de referência rápida"
                                required
                            >
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">Status Atual:</div>
                        <div class="celula entrada">
                            <select id="iniStat"></select>
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">Relacionado ao objetivo:</div>
                        <div class="celula entrada">
                            <select id="listObj"></select>
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">Descrição:</div>
                        <div class="celula entrada">
                            <textarea id="iniDesc"></textarea>
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">Motivação:</div>
                        <div class="celula entrada">
                            <textarea id="iniMot"></textarea>
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">Riscos:</div>
                        <div class="celula entrada">
                            <textarea id="iniRisk"></textarea>
                        </div> 
                    </div>
                    <div class="linha">
                        <div class="celula">
                            <div class="celula">Criação:</div>
                            <div class="celula entrada">
                                <input type="date" id="iniDataCria" value="" required>
                            </div> 
                        </div>
                        <div class="celula">
                            <div class="celula">Prazo:</div>
                            <div class="celula entrada">
                                <input type="date" id="iniDataFim" value="" required>
                            </div> 
                        </div>
                        <div class="linha">
                            <div class="celula">
                                <button type="submit" id="enviar">
                                    Gravar
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>         
        </div>
        <script>
            var dropdown = document.getElementById('iniStat');
            dropdown.length = 0

            let defaultOption = document.createElement('option');
            defaultOption.text = 'Não atribuído';

            dropdown.add(defaultOption);
            dropdown.selectedIndex = 0;

            var url = 'https://tasksbruno.herokuapp.com/ragstatus';

            const request = new XMLHttpRequest();
            request.open('GET', url, true);
            
            fetch(url)
                .then(
                    function(response) {                    
                        if (response.status !== 200) {
                            console.warn('Erro, código: ' + response.status)
                            return
                        }

                    response.json().then(function(data) {
                        let option

                        for (let i = 0; i < data.length; i++) {
                            option = document.createElement('option');
                            option.text = data[i].ragstatus;
                            option.value = data[i].ragstatus;
                            dropdown.add(option);
                        }
                    })
                }
            )
            .catch(function(err) {
                console.error("Erro de Fetch -", err)
            })
       
            //Começo lista objetivos
            var dropdownObj = document.getElementById('listObj');
            dropdownObj.length = 0

            let defaultOptionObj = document.createElement('option');
            defaultOptionObj.text = 'Não atribuído';

            dropdownObj.add(defaultOptionObj);
            dropdownObj.selectedIndex = 0;

            var urlObj = 'https://tasksbruno.herokuapp.com/listObj';

            const requestObj = new XMLHttpRequest();
            requestObj.open('GET', urlObj, true);
            
            fetch(urlObj)
                .then(
                    function(response) {                    
                        if (response.status !== 200) {
                            console.warn('Erro, código: ' + response.status)
                            return
                        }

                    response.json().then(function(data) {
                        let option

                        for (let i = 0; i < data.length; i++) {
                            option = document.createElement('option');
                            option.text = data[i].ragstatus;
                            option.value = data[i].ragstatus;
                            dropdown.add(option);
                        }
                    })
                }
            )
            .catch(function(err) {
                console.error("Erro de Fetch -", err)
            })
        </script>
    </body>
</html>
